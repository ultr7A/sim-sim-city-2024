(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function r(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(t){if(t.ep)return;t.ep=!0;const l=r(t);fetch(t.href,l)}})();const g={residential:100,commercial:150,industrial:200,road:50,power:75},M={residential:"#90EE90",commercial:"#87CEEB",industrial:"#FFB6C1",road:"#808080",power:"#FFD700",empty:"#FFFFFF"},x={residential:"🏠",commercial:"🏢",industrial:"🏭"},A=["🚗","🚙","🚐","🚛","🚕"];class c{}const i=[20,15],a=40;let p="residential",h=1e4,y=0,B=0,C,s=Array(i[1]).fill(null).map(()=>Array(i[0]).fill(null)),E=Array(i[1]).fill(null).map(()=>Array(i[0]).fill(1)),d=Array(i[1]).fill(null).map(()=>Array(i[0]).fill(0));function u(e,n){var r;(r=document.getElementById(e))==null||r.addEventListener("click",n)}function b(){u("residential",()=>m("residential")),u("commercial",()=>m("commercial")),u("industrial",()=>m("industrial")),u("road",()=>m("road")),u("power",()=>m("power")),u("bulldoze",()=>m("bulldoze")),u("nextTurn",()=>L())}document.addEventListener("DOMContentLoaded",()=>{b(),c.canvas=document.getElementById("gameCanvas"),c.ctx=c.canvas.getContext("2d"),w(c.ctx,c.canvas),v()});function m(e){p=e}function v(){document.getElementById("money").textContent=h,document.getElementById("population").textContent=y,document.getElementById("taxIncome").textContent=I()}function I(){let e=0;return s.forEach((n,r)=>{n.forEach((o,t)=>{o==="residential"&&(e+=10*(d[r][t]/100)),o==="commercial"&&(e+=15*(d[r][t]/100)),o==="industrial"&&(e+=20*(d[r][t]/100))})}),Math.floor(e)}function F(){for(let e=0;e<i[1];e++)for(let n=0;n<i[0];n++){let r=1;for(let o=-2;o<=2;o++)for(let t=-2;t<=2;t++)e+o>=0&&e+o<i[1]&&n+t>=0&&n+t<i[0]&&s[e+o][n+t]==="road"&&(r+=.2/(Math.abs(t)+Math.abs(o)));for(let o=-2;o<=2;o++)for(let t=-2;t<=2;t++)e+o>=0&&e+o<i[1]&&n+t>=0&&n+t<i[0]&&s[e+o][n+t]==="power"&&(r+=.1/(Math.abs(t)+Math.abs(o)));E[e][n]=r}}function T(e,n){for(let r=-1;r<=1;r++)for(let o=-1;o<=1;o++){if(o===0&&r===0)continue;const t=e+o,l=n+r;if(l>=0&&l<i[1]&&t>=0&&t<i[0]){const f=s[l][t];if(f&&f!=="road"&&f!=="power"&&d[l][t]>=50)return!0}}return!1}function O(){for(let e=0;e<i[1];e++)for(let n=0;n<i[0];n++)if(s[e][n]&&s[e][n]!=="road"&&s[e][n]!=="power"){let r=!1,o=!1;for(let t=-1;t<=1;t++)for(let l=-1;l<=1;l++)e+t>=0&&e+t<i[1]&&n+l>=0&&n+l<i[0]&&(s[e+t][n+l]==="road"&&(r=!0),s[e+t][n+l]==="power"&&(o=!0));r&&o&&(d[e][n]+=Math.floor(E[e][n]*5),d[e][n]=Math.min(d[e][n],100))}}function L(){B+=1,document.getElementById("turn").textContent=`Turn: ${B}`,h+=I(),F(),O(),y=0,s.forEach((e,n)=>{e.forEach((r,o)=>{r==="residential"&&(y+=Math.floor(10*E[n][o]*(d[n][o]/100)))})}),v(),w(c.ctx,c.canvas),clearTimeout(C),C=setTimeout(()=>L(),2e3)}function w(e,n){console.log("drawing grid..."),e.clearRect(0,0,n.width,n.height);for(let r=0;r<i[1];r++)for(let o=0;o<i[0];o++){const t=s[r][o];if(e.fillStyle=t?M[t]:M.empty,e.fillRect(o*a,r*a,a-1,a-1),t&&t!=="road"&&t!=="power"&&(e.fillStyle=`rgba(0, 0, 0, ${.3*(d[r][o]/100)})`,e.fillRect(o*a,r*a,a-1,a-1)),t&&x[t]&&d[r][o]>=50&&(e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(x[t],o*a+a/2,r*a+a/2)),t==="road"&&T(o,r)&&Math.random()<.4){const l=A[Math.floor(Math.random()*A.length)];e.font="16px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(l,o*a+a/2,r*a+a/2)}}}c.canvas.addEventListener("click",e=>{const n=c.canvas.getBoundingClientRect(),r=Math.floor((e.clientX-n.left)/n.width*c.canvas.width/a),o=Math.floor((e.clientY-n.top)/n.height*c.canvas.height/a);console.log("click at: ",[r,o]),r>=0&&r<i[0]&&o>=0&&o<i[1]&&(p==="bulldoze"?(s[o][r]=null,d[o][r]=0):p in g&&h>=g[p]&&(s[o][r]=p,h-=g[p],v()),w(c.ctx,c.canvas))});
