(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function o(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=o(a);fetch(a.href,l)}})();const m=[20,15],h=[m[0]*4,m[1]*4],d=40,S={star:0,space:0,void:0,air:0,cloud:0,grass:10,dirt:0,water:100,tree:50,rock:25,mountain:500,residential:100,commercial:150,industrial:200,road:50,power_line:75,power_plant:1e3,cosmic_horror:1e6,comic_relief:1e6,cuteness:1e3,existential_dread:1e6},y={void:"#000000",space:"#3000b5",star:"#ffd900",air:"#a5d5ff",cloud:"#f2f2f2",grass:"#bfff1e",dirt:"#ffcf75",water:"#2784ff",tree:"#43e000",rock:"#808080",mountain:"#cdcdcd",cuteness:"#ffd4e3",existential_dread:"#000000",cosmic_horror:"#760088",comic_relief:"#ffe100",residential:"#ff4949",commercial:"#001eff",industrial:"#ffcc00",road:"#808080",power_line:"#ffee8e",power_plant:"#ffee8e"},A={void:[" "],space:[" "],star:["ğŸŒŸ"],air:[" "],cloud:["â˜ï¸"],grass:["ğŸŒ¿","ğŸŒ±","ğŸŒ¿"],dirt:[" "," ","ğŸŒ¾"],water:[" "," ","ğŸŒŠ"],tree:["ğŸŒ²","ğŸŒ³","ğŸŒ´"],rock:["ğŸª¨","ğŸª¨","ğŸª¨"],mountain:["â›°ï¸","ğŸ”ï¸","ğŸŒ‹"],residential:["ğŸ¡","ğŸ˜ï¸","ğŸ¨"],commercial:["ğŸ¢","ğŸ¢","ğŸ¢"],industrial:["ğŸ­","ğŸ­","ğŸ­"],road:[" "],power_line:[" "],power_plant:["â˜¢ï¸"],cuteness:["ğŸ‡","ğŸ","ğŸ¿ï¸"],existential_dread:["ğŸ•³ï¸","â˜ ï¸","ğŸ˜¯"],cosmic_horror:["ğŸ‘¾","ğŸ‘½","ğŸ›¸"],comic_relief:["ğŸ­","ğŸŒ­","ğŸ¦®"]},E=["ğŸš—","ğŸš™","ğŸš","ğŸš›","ğŸš•"];class I{constructor(t,o,i){this.type=t,this.development=o,this.landValue=i,this.development=0,this.landValue=0,this.type=t}}class B{constructor(t,o,i,a,l,s){if(this.overscan=[8,8],this.width=t,this.height=o,this.globalWidth=i,this.globalHeight=a,this.x=0,this.z=0,s)this.data=s;else if(l)this.data=l(this.globalWidth,this.globalHeight);else throw new Error("Viewport must be initialized with either data or an initializer function.")}setPosition(t,o){this.x=t,this.z=o}move(t,o){console.log(`Moving viewport by (${t}, ${o})`),this.x+=t,this.z+=o}center(){this.x=Math.floor(this.globalWidth/2)-Math.floor(this.width/2),this.z=Math.floor(this.globalHeight/2)-Math.floor(this.height/2)}read(t,o){return!this.data[o+this.z]||!this.data[o+this.z][t+this.x]?new I("void",0,0):this.data[o+this.z][t+this.x]}write(t,o,i){this.data[o+this.z][t+this.x]=i}}function N(e,t,o){const i=[o.width,o.height],a=[Math.floor(i[0]*.2),Math.floor(i[1]*.2)],l=5,s=[i[0]-a[0]-l*3,l*3],{width:n,height:f,globalWidth:k,globalHeight:b}=e,L=n/k*a[0],C=f/b*a[1],g=[a[0]/k,a[1]/b];for(let v=0;v<e.globalHeight;v++)for(let M=0;M<e.globalWidth;M++){const x=e.data[v][M],O=x?y[x.type]:y.dirt;t.fillStyle=O,t.fillRect(s[0]+g[0]*M,s[1]+g[1]*v,g[0],g[1])}t.lineWidth=l,t.strokeStyle="white",t.strokeRect(s[0],s[1],a[0],a[1]);const _=[s[0]+e.x/k*a[0],s[1]+e.z/b*a[1]];t.strokeStyle="#000000",t.strokeRect(_[0]+l/2,_[1]+l/2,L,C),t.strokeStyle="#ffdf00",t.strokeRect(_[0],_[1],L,C)}function D(e,t){for(let o=-1;o<=1;o++)for(let i=-1;i<=1;i++){if(i===0&&o===0)continue;const a=e+i,l=t+o;if(l>=0&&l<m[1]&&a>=0&&a<m[0]){const s=r.map.read(a,l);if(s&&s.type!=="road"&&s.type!=="power_line"&&s.development>=50)return console.log("developed cell: ",s.type),!0}}return!1}function W(e,t){console.log("drawing grid..."),e.fillStyle=y.void,e.fillRect(0,0,t.width,t.height);for(let o=-r.map.overscan[1];o<m[1]+r.map.overscan[1];o++)for(let i=-r.map.overscan[0];i<m[0]+r.map.overscan[0];i++){const a=r.map.read(i,o);if(e.fillStyle=a?y[a.type]:y.dirt,e.fillRect(i*d,o*d,d+1,d+1),a&&a.type!=="road"&&a.type!=="power_line"&&(e.fillStyle=`rgba(255, 255, 255, ${.4*(a.development/100)})`,e.fillRect(i*d,o*d,d,d)),a&&A[a.type]&&a.development>=50&&(e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="rgba(255, 255, 255, 1)",e.fillText(A[a.type][Math.floor(a.development/33)-1],i*d+d/2,o*d+d/2)),a.type==="road"&&D(i,o)&&Math.random()<.4){const l=E[Math.floor(Math.random()*E.length)];e.font="16px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(l,i*d+d/2,o*d+d/2)}}N(r.map,e,t)}class Z{constructor(){this.init()}reset(){this.init()}init(){this.p=new Array(256).fill(0).map((t,o)=>o);for(let t=this.p.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[this.p[t],this.p[o]]=[this.p[o],this.p[t]]}this.p=[...this.p,...this.p]}fade(t){return t*t*t*(t*(t*6-15)+10)}lerp(t,o,i){return o+t*(i-o)}grad(t,o,i){const a=t&7,l=a<4?o:i,s=a<4?i:o;return(a&1?-l:l)+(a&2?-s:s)}noise(t,o){const i=Math.floor(t)&255,a=Math.floor(o)&255;t-=Math.floor(t),o-=Math.floor(o);const l=this.fade(t),s=this.fade(o),n=this.p[i]+a,f=this.p[i+1]+a;return this.lerp(s,this.lerp(l,this.grad(this.p[n],t,o),this.grad(this.p[f],t-1,o)),this.lerp(l,this.grad(this.p[n+1],t,o-1),this.grad(this.p[f+1],t-1,o-1)))}}const H=new Z;function T(e,t,o,i){return H.noise(e*.1,t*.1)}function X(e,t,o,i){return T(e,t)}function Y(e,t,o,i){return T(e,t)}function K(e,t){const o=[];for(let i=0;i<t;i++){const a=[];for(let l=0;l<e;l++){const s=new I("dirt",0,0);X(l,i)<.3&&(s.type="grass"),Y(l,i)<-.2&&(s.type="tree"),a.push(s)}o.push(a)}return o}const z=new B(m[0],m[1],m[0]*4,m[1]*4,K);z.center();const p=class p{};p.turn=0,p.money=8e3,p.population=0,p.currentTool="dirt",p.map=z,p.update=P,p.updateStats=G,p.nextTurn=V,p.drawGrid=W,p.angle=0;let r=p;function G(){document.getElementById("money").textContent=r.money,document.getElementById("population").textContent=r.population,document.getElementById("taxIncome").textContent=R()}function R(){let e=0;for(let t=0;t<h[1];t++)for(let o=0;o<h[0];o++){const i=r.map.data[t][o];i&&i.type!=="road"&&i.type!=="power_line"&&(i.type==="residential"?e+=10*(i.development/10):i.type==="commercial"?e+=15*(i.development/10):i.type==="industrial"&&(e+=20*(i.development/10)))}return Math.floor(e)}function U(){for(let e=0;e<h[1];e++)for(let t=0;t<h[0];t++){const o=r.map.data[e][t];let i=1,a=!1;for(let l=-2;l<=2;l++)for(let s=-2;s<=2;s++)if(e+l>=0&&e+l<h[1]&&t+s>=0&&t+s<h[0]){const n=r.map.data[e+l][t+s];if(!n)continue;n.type==="power_line"?i+=1.5/(Math.abs(s)+Math.abs(l)):n.type==="road"?(a=!0,i+=4.6/(Math.abs(s)+Math.abs(l))):n.type==="water"?i+=3/(Math.abs(s)+Math.abs(l)):n.type==="tree"?i+=5.4/(Math.abs(s)+Math.abs(l)):n.type==="grass"&&(i+=4.2/(Math.abs(s)+Math.abs(l)))}a||(i-=5),o.type==="residential"&&(i+=.1,console.log("land value",i)),o.landValue=i}}function $(){for(let e=0;e<h[1];e++)for(let t=0;t<h[0];t++){const o=r.map.data[e][t];if(o&&o.type!=="road"&&o.type!=="power_line"){let i=!1,a=!1,l=0;for(let s=-1;s<=1;s++)for(let n=-1;n<=1;n++)if(e+s>=0&&e+s<h[1]&&t+n>=0&&t+n<h[0]){const f=r.map.data[e+s][t+n];f.type==="power_line"&&(i=!0),f.type==="road"&&(l+=4,a=!0),f.type==="grass"&&(l+=2),f.type==="tree"&&(l+=3),f.type==="water"&&(l+=5),o.type==="industrial"&&(f.type==="industrial"&&(l+=2),f.type==="cosmic_horror"&&(l+=10)),o.type==="residential"&&(f.type==="residential"&&(l+=2),f.type==="commercial"&&(l+=2),f.type==="industrial"&&(l-=2))}if(i){let s=Math.floor(o.landValue)+l*5;a||(s-=5),(o.type==="residential"||o.type==="commercial"||o.type==="industrial")&&(console.log(o.type,{development:o.development,landValue:o.landValue,landValueFactors:l}),console.log(" cell developing by ",(s-o.development)/5)),o.development=33+(s-o.development)/5,o.development=Math.min(o.development,100)}}}}function P(){r.turn+=1,U(),$(),r.money+=R(),r.population=0;for(let e=0;e<h[1];e++)for(let t=0;t<h[0];t++){const o=r.map.data[e][t];o.type==="residential"&&(r.population+=Math.floor(10*o.landValue*(o.development/100)))}}function V(){P(),G(),document.getElementById("turn").textContent=`Turn: ${r.turn}`,r.drawGrid(r.ctx,r.canvas),clearTimeout(r.timeStep),r.timeStep=setTimeout(()=>V(),2e3)}const c={arrow_left:!1,arrow_right:!1,arrow_up:!1,arrow_down:!1,shift_left:!1,shift_right:!1};function w(e){r.currentTool=e}function j(){document.addEventListener("keydown",e=>{e.key==="ArrowUp"&&(r.map.move(0,-1),r.drawGrid(r.ctx,r.canvas)),e.key==="ArrowDown"&&(r.map.move(0,1),r.drawGrid(r.ctx,r.canvas)),e.key==="ArrowLeft"&&(r.map.move(-1,0),r.drawGrid(r.ctx,r.canvas)),e.key==="ArrowRight"&&(r.map.move(1,0),r.drawGrid(r.ctx,r.canvas)),e.key==="w"&&(r.map.move(0,-1),r.drawGrid(r.ctx,r.canvas)),e.key==="s"&&(r.map.move(0,1),r.drawGrid(r.ctx,r.canvas)),e.key==="a"&&(r.map.move(-1,0),r.drawGrid(r.ctx,r.canvas)),e.key==="d"&&(r.map.move(1,0),r.drawGrid(r.ctx,r.canvas)),e.key===" "&&(r.map.center(),r.drawGrid(r.ctx,r.canvas))})}function u(e,t){var o;(o=document.getElementById(e))==null||o.addEventListener("click",t)}function F(e){e.addEventListener("click",t=>{const o=e.getBoundingClientRect();let i=(t.clientX-o.left)/o.width*e.width,a=(t.clientY-o.top)/o.height*e.height;const l=Math.floor(i/d),s=Math.floor(a/d);console.log({cellX:l,cellY:s});const n=r.map.read(l,s);r.currentTool==="bulldoze"?(n.type="dirt",n.development=0):r.currentTool in S&&r.money>=S[r.currentTool]&&(n.type=r.currentTool,r.money-=S[r.currentTool],r.updateStats()),r.drawGrid(r.ctx,r.canvas)})}function q(){document.addEventListener("keydown",e=>{e.key==="ArrowLeft"&&(c.arrow_left=!0),e.key==="ArrowRight"&&(c.arrow_right=!0),e.key==="ArrowUp"&&(c.arrow_up=!0),e.key==="ArrowDown"&&(c.arrow_down=!0),e.key.toLowerCase()==="w"&&(c.arrow_up=!0),e.key.toLowerCase()==="a"&&(c.arrow_left=!0),e.key.toLowerCase()==="s"&&(c.arrow_down=!0),e.key.toLowerCase()==="d"&&(c.arrow_right=!0),e.key==="Shift"&&(c.shift_left=!0)})}function J(){document.addEventListener("keyup",e=>{e.key==="ArrowLeft"&&(c.arrow_left=!1),e.key==="ArrowRight"&&(c.arrow_right=!1),e.key==="ArrowUp"&&(c.arrow_up=!1),e.key==="ArrowDown"&&(c.arrow_down=!1),e.key.toLowerCase()==="w"&&(c.arrow_up=!1),e.key.toLowerCase()==="a"&&(c.arrow_left=!1),e.key.toLowerCase()==="s"&&(c.arrow_down=!1),e.key.toLowerCase()==="d"&&(c.arrow_right=!1),e.key==="Shift"&&(c.shift_left=!1)})}function Q(){document.addEventListener("wheel",e=>{const t=Math.floor(e.deltaY/80);c.shift_left?r.map.move(t,0):r.map.move(0,t),r.drawGrid(r.ctx,r.canvas)})}function ee(e,t){u("tree",()=>w("tree")),u("grass",()=>w("grass")),u("residential",()=>w("residential")),u("commercial",()=>w("commercial")),u("industrial",()=>w("industrial")),u("road",()=>w("road")),u("power_line",()=>w("power_line")),u("power_plant",()=>w("power_plant")),u("bulldoze",()=>w("bulldoze")),u("nextTurn",()=>t()),u("reset",()=>{localStorage.clear()}),q(),J(),Q(),j(),F(e)}document.addEventListener("DOMContentLoaded",()=>{r.canvas=document.getElementById("gameCanvas"),r.ctx=r.canvas.getContext("2d"),ee(r.canvas,r.nextTurn),r.drawGrid(r.ctx,r.canvas),r.updateStats()});
